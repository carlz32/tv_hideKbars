# 会话K线计数器 (Bar Count Per Session)

这是一个 TradingView Pine Script v6 指标，用于在指定的交易时段（Session）内统计并标记 K 线的序号。它可以帮助交易者清晰地识别当前 K 线处于该时段的第几根位置，常用于日内交易策略的时间分析。

## 主要功能

*   **多会话支持**：支持同时配置和显示 3 个独立的交易时段（例如：美股时段、亚盘时段、欧盘时段）。
*   **智能计数重置**：
    *   当进入新的会话时，计数自动重置为 1。
    *   支持仅显示交易时段的图表，在每天的会话开始时自动重置计数。
*   **高度可配置**：
    *   **时段与时区**：每个会话可独立设置时间范围（如 0930-1615）和时区（如 America/New_York, Asia/Shanghai 等）。
    *   **显示频率**：可以设置“每隔 X 柱显示”，避免标签过于密集（例如每 2 根 K 线显示一次标签）。
    *   **外观定制**：支持自定义标签的大小和每个会话的文字颜色。

## 参数设置

### 通用设置
*   **标签大小**：控制计数标签的显示尺寸（Auto, Huge, Large, Normal, Small, Tiny）。
*   **会话文字颜色**：分别设置会话 1、2、3 的计数标签颜色。

### 会话设置 (以会话 1 为例)
*   **显示会话1标签**：开启或关闭该会话的计数显示。
*   **会话1时段(HHMM-HHMM)**：设置会话的时间范围，格式为 `HHMM-HHMM`（例如 `0930-1615`）。
*   **会话1时区**：选择该时段对应的时区（支持 Exchange, UTC, New_York, London, Shanghai, Tokyo）。
*   **会话1每隔X柱显示**：设置标签显示的步长。设为 `1` 则每根柱都显示，设为 `5` 则每 5 根柱显示一次。

## 默认配置参考

该脚本默认预设了以下三个常用时段（可随时修改）：
1.  **会话 1** (美东时间): `0930-1615` (通常对应美股交易时段)
2.  **会话 2** (东京时间): `0900-1500` (通常对应亚盘/日股时段)
3.  **会话 3** (上海时间): `0930-1500` (通常对应 A 股/港股时段)

## 如何使用

1.  在 TradingView 图表中加载此指标。
2.  打开指标设置，根据您交易的品种和策略调整“时段”和“时区”。
3.  指标会在图表 K 线即时上方显示对应的计数值。

## 代码逻辑说明

*   **计数规则**：
    *   仅在 K 线时间落入设定的 `Session` 范围内时进行计数。
    *   如果当前 K 线是该会话的第一根（或新的一天的开始），计数重置为 1。
    *   否则，计数在上一根 K 线的基础上 +1。
*   **标签绘制**：
    *   当满足 `计数 % 步长 == 0` 时，在 K 线最高价上方绘制标签。
